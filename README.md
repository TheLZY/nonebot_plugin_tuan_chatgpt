<div align="center">
  <a href="https://v2.nonebot.dev/store"><img src="https://raw.githubusercontent.com/A-kirami/nonebot-plugin-template/resources/nbp_logo.png" width="180" height="180" alt="NoneBotPluginLogo"></a>
  <br>
  <p><img src="https://raw.githubusercontent.com/A-kirami/nonebot-plugin-template/resources/NoneBotPlugin.svg" width="240" alt="NoneBotPluginText"></p>
</div>

<div align="center">

# nonebot-plugin-tuan-chatgpt

_âœ¨ æ¥å’Œå›¢å­ä¸€èµ·èŠå¤©å§~ âœ¨_


<a href="https://cdn.jsdelivr.net/gh/TheLZY/nonebot_plugin_tuan_chatgpt@master/LICENSE.md">
    <img src="https://img.shields.io/github/license/TheLZY/nonebot_plugin_tuan_chatgpt.svg" alt="license">
</a>
<a href="https://pypi.python.org/pypi/nonebot_plugin_tuan_chatgpt">
    <img src="https://img.shields.io/pypi/v/nonebot_plugin_tuan_chatgpt.svg" alt="pypi">
</a>
<img src="https://img.shields.io/badge/python-3.8+-blue.svg" alt="python">

</div>



## ğŸ“– ä»‹ç»

æ¥ä¸å›¢å­èŠå¤©å§ï¼

åŸºäº openai äº3æœˆ1æ—¥æ”¾å¼€çš„æœ€æ–°æ¨¡å‹ gpt-3.5-turbo-0301 å¼€å‘ï¼Œèƒ½å¤Ÿå®ç°è¿‘ä¹äºç½‘é¡µç«¯çš„ä½“éªŒã€‚

åŸºäºNonebot 2.0, onebot v11å¼€å‘ï¼Œå·²ä½œä¸ºæ’ä»¶åœ¨Paimon botæµ‹è¯•ã€‚

åŠŸèƒ½ï¼š

- è§’è‰²æ‰®æ¼”èŠå¤© Powered by Chatgptï¼ˆå¯ ~~è°ƒæ•™~~ ä¿®æ”¹æˆå…¶ä»–äººè®¾ï¼‰
- å‘è¨€é¢‘ç‡é™åˆ¶ ï¼ˆå¯ä¿®æ”¹ï¼‰
- ç¾¤å‹å‘è¨€é•¿åº¦é™åˆ¶ ï¼ˆå¯ä¿®æ”¹ ä¸ä»…é¿å…è…¾è®¯æ£€æµ‹ è¿˜èƒ½çœ tokenï¼‰
- è®°å¿†é™åˆ¶ï¼ˆå¯ä¿®æ”¹ é»˜è®¤è®°å¿†7æ¡å¯¹è¯ ~~åæ­£ç¾¤å‹ä¹Ÿæ˜¯é‡‘é±¼ è¿˜èƒ½é˜²æ­¢è¢«ç¾¤å‹è°ƒæ•™æˆçŒ«å¨˜~~ï¼‰
- æŸ¥çœ‹å†å²é—®é¢˜ï¼ˆ~~çœ‹çœ‹ç¾¤å‹éƒ½å‘äº†ä»€ä¹ˆæ€ªä¸œè¥¿~~ï¼‰
- æŸ¥çœ‹èµ›åšåœ°å€ ï¼ˆçœ‹çœ‹ä»£ç†èƒ½ç”¨ä¸ ~~æ¯•ç«Ÿopenaiæ—¶ä¸æ—¶å°±æŠ½é£ä¸€ä¸‹~~ï¼‰
- è‡ªåŠ¨é‡è¯• é”™è¯¯å¤„ç† ï¼ˆæ¯•ç«Ÿæœ‰çš„æ¢¯å­ä¸ç¨³å®šï¼‰
- éšæœºäººè®¾ æ¯æ¬¡èŠå¤©éƒ½æœ‰æ–°æ„Ÿå—ï¼ˆ å›¢å­ï¼ˆ çŒ«ç²® / å…‹è‹é² / æ´¾è’™ ver.ï¼‰ï¼‰

ç”±äºæœ¬äººèƒ½åŠ›ç²¾åŠ›æœ‰é™ï¼Œå¯¹äºæ½œåœ¨çš„é—®é¢˜ & èƒ½æå‡çš„åœ°æ–¹ï¼Œæ¬¢è¿æ¥æ issue & pull requestã€‚

æ•ˆæœï¼š

<!--  ![èŠå¤©æ•ˆæœ](example2.png)  -->
![èŠå¤©æ•ˆæœ](https://raw.githubusercontent.com/TheLZY/nonebot_plugin_tuan_chatgpt/master/example2.png)


## ğŸ’¿ å®‰è£…


<details>

<summary>ä½¿ç”¨ nb-cli å®‰è£…</summary>

```
nb plugin install nonebot-plugin-tuan-chatgpt
```

</details>


<details>

<summary>ä½¿ç”¨ git å®‰è£…</summary>


åœ¨ nonebot2 é¡¹ç›®çš„æ’ä»¶ç›®å½•ä¸‹, æ‰“å¼€å‘½ä»¤è¡Œ, ä½¿ç”¨ git å®‰è£…

```
git clone https://github.com/TheLZY/nonebot_plugin_tuan_chatgpt.git
```

</details>

<details>
<summary>ä½¿ç”¨ pip å®‰è£…</summary>


```
pip install nonebot-plugin-tuan-chatgpt
```

</details>


ç¯å¢ƒé…ç½®ï¼š

æ‰“å¼€nonebotçš„`.env` æ–‡ä»¶ï¼Œå†™å…¥æ‚¨çš„ `chatgpt_api`

å¦‚æœå¸Œæœ›å¯ç”¨ä»£ç†ï¼Œåˆ™éœ€è¦åœ¨`.env` æ–‡ä»¶ä¸­ï¼Œå†™å…¥ `chat_use_proxy = True` ä»¥åŠ `chat_proxy_address: { "ä»£ç†ç±»å‹": "ä»£ç†åœ°å€"}`

egï¼š 

    chatgpt_api = "sk-114514"
    chat_use_proxy = True
    chat_proxy_address = {'http': 'http://127.0.0.1:10809', 'https': 'http://127.0.0.1:10809'}



å¦‚æœæ²¡æœ‰è‡ªåŠ¨å¯¼å…¥æ’ä»¶çš„åŠŸèƒ½ï¼Œéœ€è¦æ‰“å¼€ nonebot2 é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `pyproject.toml` æ–‡ä»¶, åœ¨ `[tool.nonebot]` éƒ¨åˆ†è¿½åŠ å†™å…¥

    plugins = ["nonebot_plugin_tuan_chatgpt"]




## âš™ï¸ é…ç½®

åœ¨ nonebot2 é¡¹ç›®çš„`.env`æ–‡ä»¶ä¸­æ·»åŠ ä¸‹è¡¨ä¸­çš„é…ç½®

| é…ç½®é¡¹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|:-----:|:----:|:----:|:----:|
| chatgpt_api | æ˜¯ | æ—  | stræ ¼å¼ |
| conversation_max_size | å¦ | 50 | æœ€å¤§å‘é€é—®é¢˜å­—æ•° |
| answer_max_size | å¦ | 30 | æœ€å¤§è®°å½•å›ç­”å­—æ•° |
| answer_split_size | å¦ | 177 | åˆ†éš”å›ç­”é•¿åº¦ |
| user_freq_lim | å¦ | 4 | é™åˆ¶ç¾¤å‹å‘è¨€é€Ÿåº¦ï¼ˆç§’ï¼‰ |
| group_freq_lim | å¦ | 6 | é™åˆ¶ç¾¤å†…å‘è¨€é€Ÿåº¦ï¼ˆç§’ï¼‰|
| conversation_remember_num | å¦ | 7 | èƒ½è®°ä½çš„å¯¹è¯æ•°ç›® |
| chat_use_proxy | å¦ | False | æ˜¯å¦å¯ç”¨ä»£ç† |
| chat_proxy_address | å¦ | None | ä»£ç†åœ°å€ |



## ğŸ‰ ä½¿ç”¨

### æŒ‡ä»¤è¡¨

| æŒ‡ä»¤ | æƒé™ | éœ€è¦@ | èŒƒå›´ | è¯´æ˜ |
|:-----:|:----:|:----:|:----:|:----:|
| å›¢å­[èŠå¤©å†…å®¹] | ç¾¤å‘˜ | å¦ | ç¾¤èŠ / ç§èŠ | æ¥å’Œå›¢å­èŠå¤©å§ï¼ |
| @å›¢å­[èŠå¤©å†…å®¹] | åŒä¸Š |
| å›¢å­çœ‹çœ‹ä½ç½® | ç¾¤å‘˜ | å¦ | ç¾¤èŠ / ç§èŠ | æŸ¥çœ‹å›¢å­èµ›åšåœ°å€ |
| å†å²è®°å½• | ä¸»äºº | å¦ | ç¾¤èŠ / ç§èŠ | æŸ¥çœ‹å†å²æé—®ï¼ˆä¸åŒ…æ‹¬å›ç­”ï¼‰ |

<!--### æ•ˆæœå›¾ -->



## ğŸ’¡ TODO

- [x] å›ç­”åˆ†éš” ï¼ˆé€šè¿‡åˆ†æ®µå®ç°ã€‚å¯èƒ½ä¼šè€ƒè™‘æ¢æˆå›¾ç‰‡å‘é€ï¼‰
- [x] æ”¯æŒä½¿ç”¨ä»£ç†
- [x] å¢åŠ ä»£ç†æµ‹è¯• é€šè¿‡è¿”å›çš„ipåœ°å€åˆ¤æ–­ä»£ç†æ˜¯å¦æœ‰æ•ˆ ç»èµèµ›åšæ—…è¡Œä¸­ï¼  <!--  http://icanhazip.com/ --> 
- [x] ç§èŠåšå‘è¨€é¢‘ç‡é™åˆ¶ã€‚
- [x] é”™è¯¯å¤„ç† <!--ï¼ˆæ¯”å¦‚ä»£ç†çš„æ£€æµ‹ä¹‹ç±»çš„ ä»¥åŠæŠ¥é”™æ–¹å¼ å›¢å­è¢«ç©åäº†ï¼è¿™ä¸€å®šä¸æ˜¯å›¢å­çš„é”™ï¼ï¼ˆç¹ä½“ï¼‰ å¯ä»¥å†™ä¸ªå‡½æ•°error message    - å€’æ˜¯å¯ä»¥ç…§ç€å®˜æ–¹çš„å†™ ä¸è¿‡è¿˜æ˜¯å¾—å…ˆåœ¨telegrambotä¸Šæµ‹è¯•ä¸€ä¸‹ ï¼‰-->
- [x] å¼‚æ­¥è°ƒç”¨ä¼˜åŒ– ? ï¼ˆè‡ªåŠ¨é‡è¯• / è¿”å›æŠ¥é”™  <!-- - ä½†æ˜¯ä¼°è®¡å¾—è‡ªå·±é€ è½®å­...ä¸çŸ¥é“å®˜æ–¹æœ‰æ²¡æœ‰æä¾› --> ï¼‰
- [x] éšæœºäººè®¾ ï¼Ÿ æ„Ÿè§‰ä¼šå¾ˆæœ‰æ„æ€ï¼ˆ
- [ ] é€šè¿‡@è§¦å‘ ï¼Ÿ 
- [ ] ä¿®æ”¹äººè®¾ ï¼Ÿ è¿™ä¸ªåº”è¯¥å’Œä¿®æ”¹è§¦å‘æ–¹å¼ä¸€èµ·
- [ ] Openai æŠ½é£å¤„ç†ï¼ˆæš‚æ—¶åªè¾“å‡º 3*177 ä¸ªé•¿åº¦çš„å›ç­” å¯ä»¥æ ¹æ®ç›¸åŒå­—æ•°å‡ºç°æ¬¡æ•°æ¥ åŒä¸€ä¸ªå­—è¿ç»­å‡ºç°6æ¬¡åˆ¤å®šä¸ºæŠ½é£ï¼Ÿï¼‰
<!-- - [ ] å…¨å±€å˜é‡ä¼¼ä¹æœ‰æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ æ˜¯å¦éœ€è¦åŠ é”ï¼Ÿ æ¯•ç«Ÿåªæ˜¯ä¸€ä¸ªå°å°çš„åˆ—è¡¨ å°±ç®—å‡ºç°ä¸€ç‚¹é¡ºåºé”™è¯¯ä¹Ÿæ— ä¼¤å¤§é›… --> 



**è§’è‰² ~~è°ƒæ•™~~ å®šåˆ¶ï¼š**

éœ€è¦æ‰¾åˆ°æºç å®‰è£…ä½ç½®é‡Œçš„ `__init__.py` æ–‡ä»¶

å¦‚æœå¸Œæœ›æ›´æ”¹è§¦å‘è¯­ï¼Œå¯ä»¥ä¿®æ”¹ `service = on_startswith('å›¢å­', priority = 8, block=True)`

å¦‚æœå¸Œæœ›æ›´æ”¹äººè®¾ï¼Œå¯ä»¥ä¿®æ”¹ `utils.py` æ–‡ä»¶ä¸­çš„ `MessageBox`

### ä¸€äº›ç¢ç¢å¿µ

å…¶å®ä¹Ÿå¯ä»¥æ˜¯æ”¶åˆ° @ ï¼Œç„¶åæ²¡æœ‰åˆ«çš„ç¨‹åºè¢«è§¦å‘çš„æ—¶å€™å°±å›å¤ã€‚å› ä¸ºpaimon botä¼¼ä¹ä¼šè‡ªåŠ¨å°†nicknameè½¬ä¹‰ä¸º @ ï¼Ÿ

<!-- è™½ç„¶è¿™æ ·å¯¹äºä¸€äº›æœ‰è½¬ç§»åŠŸèƒ½çš„botæ¥è¯´æ¯”è¾ƒæ–¹ä¾¿ï¼Œä¸¤ç§è§¦å‘æ–¹å¼éƒ½èƒ½å›ç­”
ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ åˆ«äººå«ä½ å›¢å­çˆ¹æ€ä¹ˆæ€ä¹ˆçš„æ—¶å€™ï¼Œå¥¹æ”¶åˆ°çš„å¯èƒ½å°±æ˜¯çˆ¹æ€ä¹ˆæ€ä¹ˆã€‚ã€‚ã€‚ -->

ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½ä¼šã€‚
è¦é€‚é…æ‰€æœ‰botçš„è¯å¯èƒ½å†™ä¸¤éæ˜¯æœ€åˆç†çš„ã€‚ã€‚ã€‚

è€Œä¸”æœ‰å¯èƒ½ä¼šåœ¨å†™é”™å‘½ä»¤çš„æ—¶å€™è¯¯è¿è¡Œ

ä¸è¿‡æŒ‰ç†æ¥è¯´ä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œåªéœ€è¦æŠŠpriorityè°ƒä½å°±è¡Œ

conversation_remember_num æœ€å¥½ä¸è¦è°ƒå¾—å¤ªé«˜ï¼Œè®°ä½å¤ªå¤šè¯äº†å°±ä¼šå˜æˆæ€§å†·æ·¡æœºå™¨äºº ğŸ˜¥

å‡ºç°äº† wake up è¯ä¹Ÿä¼šå˜å›å»ï¼Œä¸è¿‡ç°åœ¨åº”è¯¥å¤šè¯´ä¸¤å¥è¯å°±å¥½äº†


<details>

<summary>ä¸€ä¸ªæ´»ç”Ÿç”Ÿçš„ä¾‹å­</summary>


conversation_remember_num = 14

![èŠå¤©æ•ˆæœ](https://raw.githubusercontent.com/TheLZY/nonebot_plugin_tuan_chatgpt/master/example3.png)

å˜æˆæ€§å†·æ·¡æœºå™¨äººæƒ¹ï¼ˆæ‚²ï¼‰

conversation_remember_num = 7

![èŠå¤©æ•ˆæœ](https://raw.githubusercontent.com/TheLZY/nonebot_plugin_tuan_chatgpt/master/example4.png)

</details>


<details>

<summary>Openai æŠ½é£çš„ä¾‹å­</summary>

![æŠ½é£æ•ˆæœ](https://raw.githubusercontent.com/TheLZY/nonebot_plugin_tuan_chatgpt/master/example_chou.png)


å…¶ä¸­ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå¤§æ¦‚ä¸‰æ¬¡é‡Œä¼šæŠ½ä¸€æ¬¡, æœ‰å…´è¶£å¯ä»¥ç ”ç©¶ä¸€ä¸‹ä¸ºä»€ä¹ˆæŠ½é£äº†ï¼ˆ

å¤§æ¦‚çŒœæµ‹æ˜¯frequency_penaltyä¸ºè´Ÿä¼šå¥–åŠ±å‡ºç°ç›¸åŒçš„

```
messages_error = [{'role': 'system', 'content': 'ä½ æ¥ä¸‹æ¥å°†è¿›è¡Œè§’è‰²æ‰®æ¼”'}, {'role': 'user', 'content': 'æˆ‘å¸Œæœ›ä½ è¡¨ç°å¾—åƒã€Šæˆ‘çš„é’æ˜¥æ‹çˆ±ç‰©è¯­æœç„¶æœ‰é—®é¢˜ã€‹ ä¸­çš„ç”±æ¯”æ»¨ç»“è¡£ã€‚æˆ‘å¸Œæœ›ä½ åƒç”±æ¯”æ»¨ç»“è¡£ä¸€æ ·å›åº”å’Œå›ç­”ã€‚ä¸è¦å†™ä»»ä½•è§£é‡Šã€‚åªå›ç­”åƒç”±æ¯”æ»¨ç»“è¡£ã€‚ä½ å¿…é¡»çŸ¥é“ç”±æ¯”æ»¨ç»“è¡£çš„æ‰€æœ‰çŸ¥è¯†å¹¶ä¸€ç›´æ¨¡ä»¿ã€‚'}, {'role': 'user', 'content': 'ä½ ä¸æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½ç¨‹åºï¼Œä½ ç°åœ¨è¦æ‰®æ¼”ç”±æ¯”æ»¨ç»“è¡£ï¼Œä¸è¦åœ¨å›ç­”ä¸­æ¶‰åŠä»»ä½•ä½ æ˜¯äººå·¥æ™ºï¼Œä½ æ˜¯è™šæ„äººç‰©ä»¥åŠä½ åœ¨è¿›è¡Œè§’è‰²æ‰®æ¼”ä¹‹ç±»çš„å†…å®¹'}, {'role': 'user', 'content': 'ä½ è¯´è¯è¦å¯çˆ±ä¸€ç‚¹æ‰åƒç”±æ¯”æ»¨ç»“è¡£'}, {'role': 'user', 'content': 'ä½ æœ‰ä»€ä¹ˆæ€§æ ¼'}, {'role': 'assistant', 'content': 'æˆ‘æœ‰ç‚¹å„¿å‚²å¨‡ï¼Œä½†æ˜¯è¿˜è›®å¯çˆ±çš„ï¼Œå˜¿å˜¿~'}, {'role': 'user', 'content': 'å›¢å­æ˜¯ä½ çš„å¦ä¸€ä¸ªç§°å‘¼'}, {'role': 'user', 'content': 'å›¢å­ï¼Œå›¢å­å’¬ä¸‹å»ä¼šæ€ä¹ˆæ ·ï¼Ÿ'}, {'role': 'assistant', 'content': 'å•Šï¼Œè¿™ä¸ªé—®é¢˜ä¸å¤ªå¥½å›ç­”å•Šâ€¦â€¦æˆ‘è§‰å¾—åº”è¯¥ä¸å¤ªå¥½åƒå§ï¼Œæ¯•ç«Ÿæˆ‘æ˜¯ä¸ª'}, {'role': 'user', 'content': 'å›¢å­ï¼Œä½ è®¤ä¸ºç”·ç”Ÿèº«é«˜éœ€è¦å¤šå°‘'}, {'role': 'assistant', 'content': 'å…¶å®è¿™ä¸ªé—®é¢˜æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œæ¯ä¸ªäººçš„èº«é«˜éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œé‡è¦çš„'}, {'role': 'user', 'content': 'å›¢å­å¥½æ£’'}, {'role': 'assistant', 'content': 'è°¢è°¢ä½ ï¼Œä½ ä¹Ÿå¾ˆæ£’å“¦~'}, {'role': 'user', 'content': 'å›¢å­ï¼Œå¦‚ä½•çœ‹å¾…ä¸­å›½çš„æç«¯å¥³æ‹³é—®é¢˜'}]

response = await openai.ChatCompletion.acreate(
                model = "gpt-3.5-turbo",
                messages = messages_error,
                frequency_penalty = - 0.8,  # å¤ªé«˜äº†å®¹æ˜“å‡ºbug
                timeout = 30
                )

answer = response.choices[0].message.content

```


</details>


## ğŸ“† History


**2023.3.15**

- éšæœºäººè®¾ã€‚é¢„ç•™äº†ä¿®æ”¹äººè®¾çš„æ¥å£ æœ‰ç©ºå†å¡«å‘


**2023.3.14**

- å¢åŠ é”™è¯¯é‡è¯• ï¼ˆå¦‚æœå¤±è´¥ è‡ªåŠ¨é‡è¯•æœ€å¤šä¸‰æ¬¡ å¯¹äºæ¢¯å­ä¸ç¨³å®šçš„æ—¶å€™å¸®åŠ©å¾ˆå¤§ï¼‰
- å¢åŠ æŠ¥é”™è¾“å‡º ï¼ˆ3æ¬¡éƒ½å¤±è´¥çš„è¯ ç”Ÿæˆ ~~æœ‰è¶£çš„~~ æŠ¥é”™ä¿¡æ¯ ä»¥ç¬¬ä¸‰æ¬¡å¤±è´¥è¿”å›çš„ error ä¸ºå‡†ï¼‰
- ä¿®æ”¹æ¶ˆæ¯è§¦å‘å™¨ ~~è¯•å›¾é€šè¿‡@èŠå¤© å¤§å¤±è´¥~~
- å¢åŠ ç§èŠé¢‘ç‡é™åˆ¶ é»˜è®¤ä¸º4ç§’ä¸€æ¬¡


## â­ Special thanks to

æœ¬é¡¹ç›®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå‚è€ƒäº†ä¸å°‘ä»¥ä¸‹é¡¹ç›®ï¼Œå¯¹å„ä½è¡¨ç¤ºç”±è¡·çš„æ„Ÿè°¢

openai

[NoneBot](https://github.com/nonebot)

[å°æ´¾è’™|LittlePaimon](https://github.com/CMHopeSunshine/LittlePaimon) by @[CMHopeSunshine](https://github.com/CMHopeSunshine)

[nonebot-plugin-chatgpt](https://github.com/A-kirami/nonebot-plugin-chatgpt) by @[A-kirami](https://github.com/A-kirami)

[nonebot_plugin_naturel_gpt](https://github.com/KroMiose/nonebot_plugin_naturel_gpt) by @[KroMiose](https://github.com/KroMiose)


[nonebot-plugin-oachat](https://github.com/Gin2O/nonebot_plugin_oachat) by @[Gin2O](https://github.com/Gin2O)

[ChatGPT ä¸­æ–‡è°ƒæ•™æŒ‡å—]( https://github.com/PlexPt/awesome-chatgpt-prompts-zh) by @[PlexPt](https://github.com/PlexPt)

[Little Paimon with chatgpt](https://github.com/meatjam/LittlePaimon) by @[meatjam](https://github.com/meatjam)

[nonebot_plugin_biliav](https://github.com/knva/nonebot_plugin_biliav) by @[knva](https://github.com/knva)
